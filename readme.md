# ESP32-off_line-clock

基于**Micropython**使用**ESP32**制作了一个简易版的**离线桌面时钟** *<u>(离线的目的为了带到学校里)</u>*

### 功能：

- 展示 年—月—日—星期—时—分—秒

- 实时测量环境中的温度与湿度

- 可以通过浏览器的方式进行重置时间

![1](https://github.com/hqy1433/esp32-off_line-clock/blob/main/doc/1.JPG)

## 搭建方案:

——————————————————————————

## 1.物料清单

- ESP-WROOM-32 开发板(CH340芯片 Type-C) 带数据线 ￥24.8  [点我跳转](https://m.tb.cn/h.5vt2REpZAMsdKbV?tk=ByuvWmuL24V )

- 1.54寸 LCD ST7789 焊针 带PCB ￥15.99 [点我跳转](https://m.tb.cn/h.5EtKQuqBa6zblVQ?tk=RhPEWmuqnTj)

- DS3231 时钟模块 带电池 ￥15.87 [点我跳转](https://m.tb.cn/h.5vt3S7D7rVqicFa?tk=uWKAWmuJifR)

- DHT22 单总线￥12.74 [点我跳转](https://m.tb.cn/h.5EtrkqwlZ4rVSRs?tk=HkqtWmuI9Lf)

- 面包板/esp32拓展版

- 杜邦线若干

- 两脚轻触开关(可选)

**<mark>(注意有些线可能只有供电功能 一般可选用原装手机的充电线)</mark>**

## 2.硬件介绍

- ST7789———LCD屏幕

- DS3231———时钟模块

- DHT22———测量温度与湿度

## 3.硬件连接

#### ST7789——————————ESP32

- GND   ———GND

- VCC   ———3V3

- SCL   ———D18

- SDA   ———D23

- RES   ———D15

- DC    ———D2

- CS    ———D5

- BLK   ———空

#### DS3231——————————ESP32

- GND   ———GND

- VCC    ———3V3

- SDA    ———D21

- SCL     ———D22

#### DHT22——————————ESP32

- “-”         ———GND

- “OUT”   ———D4

- “+”        ———3V3 

<mark>**(不正确的接线在上电后 可能损伤元器件！！！)**</mark>

#### 轻触开关 ——————————ESP32

- D19 ——— 开关 ———VCC

## 软件搭建

使用的IDE为[Tonny](https://thonny.org/) <u>(如果下载失败可以考虑用我提交的thonny-4.1.4 适用于Windows 10 x64)</u>

为什么用Thonny？ Thonny一个软件就可以解决 连接串口|烧录固件|管理内部文件 的一系列问题<u> (说实在的 我并不觉得好用，但我是懒人)</u>

给电脑打上相应芯片的驱动，识别开发板端口(提供CH340的驱动 **CH341SER**)

CH341SER用法: 解压后，32位系统直接运行SETUP.EXE，64位系统运行DRVSETUP64/DRVSETUP64.exe，然后在弹出窗口直接点'**安装**'即可

#### 0.烧录固件

烧录固件的意义在于给硬件打驱动，就像你给你的电脑安装操作系统。你的程序是基于你的 固件/操作系统 工作的

对于ESP32的固件支持两种语言:Micropython，C

这个项目是基于Micropython编写的，所以烧录Micropython的固件 [官网地址](https://micropython.org/download/ESP32_GENERIC/) (如果下载失败可以考虑用我提交的**ESP32_GENERIC-20240222-v1.22.2.bin**)

打开**Thonny**—左上角“**运行**”—选择**解释器**—选择**”ESP32**“—下方蓝字“**安装或更新Micropython**”(第一次使用可能需要<mark>**pip install esptools**</mark>)—弹出框中按“**安装**”右边的三横—中的“**Local Micropython image**”—选择“XXX.bin”文件—其他保持**不变**—**安装**

### **<mark>(烧录过程中千万别拔开发板的电源！！！)</mark>**

### 1.传入程序

正确烧录固件后，在右下角选择开发板

右边“文件系统”会自动弹出ESP32开发板内的储存文件(若没有，请自行选择 **视图-文件**)

请将“<u>esp32-off_line-clock\1.传入程序</u>”中的所有文件传入至开发板根目录<u>(右键下载，方便的很)</u>

重启开发板

(解释:每次开发板 复位/上电 后都会默认执行一次boot.py-main.py 而我在main.py写的是无限循环的死程序，所以可能会出现Thonny与开发板断开连接的可能，不要惊慌，点上方的“stop”基本就可以解决问题，还不行的话可以试试先下电，在上电一瞬间猛按“stop”)

以下对上传的文件做出解释:

boot.py—————程序自动生成，~~无关紧要~~

DS3231micro.py—————DS3231的程序库 (来源:github上有个大佬)

index.html—————用于重新设定时间的网页结构(来源:百度文心一言AI生成，我做了一点修改)

main.py—————主程序

st7789.py—————ST7789屏幕的程序库(来源:github上有个大佬)

st7789py.py—————ST7789屏幕的程序库(来源:github上有个大佬)

vga2_8x16.py—————兼容ST7789屏幕的字体库(来源:github上有个大佬)

vga2_16x32.py—————兼容ST7789屏幕的字体库(来源:github上有个大佬)

##### main.py的运行逻辑:

![2](https://github.com/hqy1433/esp32-off_line-clock/blob/main/doc/2.jpg)

### *3.二次开发

开源的目的就是为了共享代码二次开发(~~二次折腾~~)

如果你对与这个项目有其他想法功能的话可以上手试试看

这里有一点需要提示:

DHT22使用(<u>通电过程中可能产生热量，导致读数不准</u>)

```micropython
d.measure()
```

<mark>**方法获取温度和湿度时，不能太快，否则会出现报错**</mark>

(我代码里没有使用停顿的原因是刚好运行上面太久了，导致刚好卡着这个极限过的，这也就是为什么秒数走的一会快一会慢的原因)

### 优化方向

- 可以通过增加开关的方式实现翻页的操作

- 充分利用屏幕空间，在上面同时显示GIF动画

- 多线程的方式使DS3231与DHT22的数据分开读取(不会有秒数忽快忽慢的现象)

- 选择新的字体文件，制作新的UI

- 外壳设计

## Last.写在最后的话

这个项目其实很多用的都是别人的东西~~(我是彩笔)~~

播放GIF的方式其实我已经实现了，但是无法与这个程序结合~~(我是彩笔)~~

<mark>如果你对这个项目感兴趣的话，不妨点个Star~</mark>

<mark>侵权联删</mark>
